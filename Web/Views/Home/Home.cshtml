@model Web.Models.HomeViewModel
@{
    ViewData["Title"] = "Home";
}

<div class="container">

    <!-- User Stats and Quick Actions -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5>🏆 Your Stats</h5>
                </div>
                <div class="card-body d-flex flex-column text-center justify-content-between">
                    <div class="flex-grow-1 d-flex flex-column justify-content-center">
                        <h2 class="text-primary mb-4">@Model.User.Name</h2>
                        <h3 class="text-primary mb-4">You are @Model.UserRank<sup>@GetOrdinalSuffix(Model.UserRank)</sup> of @Model.TotalPlayers players</h3>
                        <h1 class="text-success mb-4">Total Points: <strong>@Model.User.TotalPoints</strong></h1>
                    </div>
                    <a href="/myteam" class="btn btn-primary btn-lg">🏀 Manage My Team</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h5>📈 Performance History</h5>
                </div>
                <div class="card-body d-flex flex-column">
                    @if (Model.RoundPoints.Any())
                    {
                        <div style="max-height: 300px; overflow-y: auto; flex: 1;">
                            @foreach (var round in Model.RoundPoints.OrderByDescending(r => r.Round))
                            {
                                <div class="d-flex justify-content-between align-items-center mb-2 p-2 border-bottom">
                                    <span><strong>Round @round.Round</strong></span>
                                    <span class="badge bg-primary">@round.Points pts</span>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <p class="text-muted">No rounds played yet</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>🏆 Leaderboard</h5>
                </div>
                <div class="card-body">
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-striped">
                            <thead class="sticky-top bg-white">
                                <tr>
                                    <th>Rank</th>
                                    <th>Player</th>
                                    <th>Total Points</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var entry in Model.Leaderboard)
                                {
                                    <tr class="@(entry.UserId == Model.User.Id ? "table-primary" : "")">
                                        <td>
                                            @if (entry.Rank <= 3)
                                            {
                                                <span class="badge bg-@(entry.Rank == 1 ? "warning" : entry.Rank == 2 ? "secondary" : "danger")">
                                                    @entry.Rank
                                                </span>
                                            }
                                            else
                                            {
                                                @entry.Rank
                                            }
                                        </td>
                                        <td>
                                            @entry.UserName
                                            @if (entry.UserId == Model.User.Id)
                                            {
                                                <span class="badge bg-primary">You</span>
                                            }
                                        </td>
                                        <td>@entry.TotalPoints</td>
                                        <td>
                                            <a href="/playerhistory?id=@entry.UserId" class="btn btn-sm btn-outline-info">
                                                📊 View History
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@functions {
    private string GetOrdinalSuffix(int number)
    {
        if (number >= 11 && number <= 13)
            return "th";
        
        return (number % 10) switch
        {
            1 => "st",
            2 => "nd", 
            3 => "rd",
            _ => "th"
        };
    }
}
